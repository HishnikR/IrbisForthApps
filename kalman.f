
int Ysize
create Y[]
"456.txt" 0 file.text.open drop
0 Y[] file.text.fx to Ysize
Ysize cells allot
Ysize .

100 CONSTANT DATASIZE

CREATE X[] DATASIZE FLOATS ALLOT

int data[]
x[] to data[]
INT SIZE
YSIZE TO SIZE


INT WINDOW
100 TO WINDOW
INT TIME

50 TO TIME

FLOAT SIGMA
FLOAT SIGMA0
FLOAT EPSILON

1.0 SIGMA0 F!
0.1 EPSILON F!

FLOAT X0

PROC P(X) // F:X-- F: P
  X0 F!
  0.0
  WINDOW 0 DO
    DATA[] TIME I - -TH F@ X0 F@ F-
    I S>F EPSILON F@ F* SIGMA0 F@ F+ SIGMA F!
    SIGMA F@ FGAUSS
    SIGMA F@ F/
    F+
  LOOP
ENDPROC

PROC FILLCONST
  DATASIZE 0 DO
    1.0 X[] I -TH F!
    I 50 > IF 2.0 X[] I -TH F! THEN
  LOOP
ENDPROC

FILLCONST

FLOAT XMIN
FLOAT XMAX
FLOAT XSTEP
INT STEPS

FLOAT PMAX
FLOAT ARGMAX


PROC FINDX
  XMAX F@ XMIN F@ F- STEPS S>F F/ XSTEP F!
  0.0 PMAX F!
  XMIN F@ ARGMAX F!
  XMIN F@ X0 F!
  STEPS 0 DO
    X0 F@ P(X) FDUP PMAX F@ F> IF
      FDUP PMAX F! X0 F@ ARGMAX F!
    THEN FDROP
    X0 F@ XSTEP F@ F+ X0 F!
  LOOP

ENDPROC

0.0 XMIN F!
5.0 XMAX F!
1000 TO STEPS

0 CHART.SHOW
0 CHART.ALIGN.CLIENT
0 0 CHART.ADDSERIES
3 0 SERIES.LINEWIDTH
1 0 CHART.ADDSERIES
3 1 SERIES.LINEWIDTH
0x00FF00 1 SERIES.COLOR
2 0 CHART.ADDSERIES
3 2 SERIES.LINEWIDTH
0xFF0000 2 SERIES.COLOR

3 0 CHART.ADDSERIES
5 3 SERIES.LINEWIDTH
0x00FF 3 SERIES.COLOR


INT GRAPH
0 TO GRAPH

PROC AVERAGE
  GRAPH SERIES.CLEAR
  SIZE WINDOW DO
     I TO TIME
     0.0
     WINDOW 0 DO
       X[] TIME I - -TH F@ F+
     LOOP
     WINDOW S>F F/
     I S>F FSWAP GRAPH SERIES.FXY
  LOOP
ENDPROC

PROC RUN
  GRAPH SERIES.CLEAR
  SIZE WINDOW DO
     I TO TIME
     FINDX
     I S>F ARGMAX F@ GRAPH SERIES.FXY
  LOOP
ENDPROC


// ARRAY_FMIN : begin // addr, n -- index_min, f: min

Y[] TO DATA[]

DATA[] SIZE [FMIN] XMIN F! DROP
DATA[] SIZE [FMAX] XMAX F! DROP

100 TO STEPS

DATA[] SIZE 0 series.plotfx

0.001 EPSILON F!
1 TO GRAPH
RUN

0.1 EPSILON F!
2 TO GRAPH
RUN



