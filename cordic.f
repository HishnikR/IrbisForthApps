
int x
int y
int phase
int ph
int step

128 constant #atan

create atan[]

// https://keisan.casio.com/calculator
// 2^31*atan(1/2^x);

1686629713.065252369824872831112032264345564723261  f>s ,
995675658.76352875338850292154506107457838135344153 f>s ,
526087673.1738413206018981065084820371560643831893  f>s ,
267050317.33629935308684890586491949979937281434668 f>s ,
134043373.79393735195330789862991669248985548425452 f>s ,
67087031.457744871507992671462171891164828002481203 f>s ,
33551701.73326359211187897948800917242376278068403  f>s ,
16776874.679166121735783214211739553638922917944052 f>s ,
8388565.3337239540759092333723486989723391908967198 f>s ,
4194298.6666788736646552448308683579137078690051777 f>s ,
2097151.3333337148028000403970022563267444321690626 f>s ,
1048575.9166666785875935916230659539660827059559182 f>s ,
524287.98958333370586234731919655163843107266065368 f>s ,
262143.99869791667830819872545132983542752333493891 f>s ,
131071.9998372395836971312130744669772992730506825  f>s ,
65535.999979654947928035350431265475474169459789905 f>s ,
32767.999997456868489938604701154299096811521672575 f>s ,
16383.999999682108561209018896912456635746954557546 f>s ,
8191.9999999602635701500865280285250885309347487057 f>s ,
4095.9999999950329462687282899383914935374029833811 f>s ,
2047.9999999993791182835900198027622348333626813039 f>s ,
1023.9999999999223897854487207116097573437013247132 f>s ,
511.99999999999029872318108909633448460453096906074 f>s ,
255.99999999999878734039763610602253760482940764771 f>s ,
127.99999999999984841754970451228346492026810894887 f>s ,
63.99999999999998105219371306400514085627302686137  f>s ,
31.999999999999997631524214132999695973947863144255 f>s ,
15.999999999999999703940526766624932414459537105095 f>s ,
7.9999999999999999629925658458281156273610688322637 f>s ,
3.9999999999999999953740707307285144245311844382244 f>s ,
1.9999999999999999994217588413410643021636183933465 f>s ,
0.99999999999999999992771985516763303774224043474858 f>s ,

proc deg->phase
  s>f pi f* 2147483648.0 f* 180.0 f/ f>s
endproc

proc phase->deg
  s>f 2147483648.0 f/  180.0 f* pi f/ f>s
endproc

int tempx
int tempy

proc CORDIC-STEP
  x to tempx
  y to tempy
  ph phase < if
    ph atan[] step -th @ + to ph
    x tempy step rshift - to x
    y tempx step rshift + to y
  else
    ph atan[] step -th @ - to ph
    x tempy step rshift + to x
    y tempx step rshift - to y
  then
  step 1 + to step
endproc

proc cordic
  0 to ph
  0 to step
  2147483648 to x
  0 to y
  32 0 do
    cordic-step
  loop
endproc

proc test-steps
  "testing CORDIC steps" print
  0 series.clear
  1 series.clear
  30 deg->phase to phase
  0 to ph
  0 to step
  2147483648 to x
  0 to y
  32 0 do
    cordic-step x .
    i x  0 series.xy
    i y  1 series.xy
  loop
endproc

proc test
  "testing degrees 0..90" print
  0 series.clear
  1 series.clear
  90 0 do
    i deg->phase to phase cordic ph phase->deg .
    i s>f x s>f 2147483648.0 f/ 0 series.fxy
    i s>f y s>f 2147483648.0 f/ 1 series.fxy
  loop
endproc

0 chart.show
0 chart.align.client
0 0 chart.addseries
1 0 chart.addseries
0xFF00FF 0 SERIES.COLOR
3 0 SERIES.LINEWIDTH
0x003FFF 1 SERIES.COLOR
3 1 SERIES.LINEWIDTH

// test

